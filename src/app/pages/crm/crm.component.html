  
  <!-- ============================================================== -->
  <!-- Chat component -->
  <!-- ============================================================== -->
    <div class="row">
    <div class="col-12">
      <div class="card m-b-0">
        <!-- .chat-row -->
        <div class="chat-main-box">
          <!-- Clientes .chat-left-panel -->
          <div class="row">
            <div class="col col-lg-3 col-md-3 col-sm-12 col-12">
              
                <div class="form-material" *ngIf="!chatProyectos">
                  <input [(ngModel)]="terminoBusqueda"
                         (keyup)="buscarCliente()"
                         name="clientesFiltrados" 
                         class="form-control p-20" type="text" placeholder="Buscar Cliente">
                </div>
                
                <!-- Chat de clientes -->
                <div class="chat-clientes" *ngIf="!chatProyectos">
                  <ul class="chatonline style-none">
                    <li *ngFor="let cliente of clientesFiltrados; let i=index;"
                        (click)="seleccionarCliente(cliente,i)">
                      <a class="list-cliente">
                        <img [src]="cliente.imagen" 
                             class="img-circle"
                             *ngIf="cliente.imagen">
                        <div class="iniciales-cliente align-content-center"
                             *ngIf="!cliente.imagen"
                             [ngStyle]="{ 'background-color': cliente.backgroundColor }">
                          {{ cliente.nombre | iniciales }}
                        </div>
                        <span>
                          {{ cliente.nombre }}
                          <small 
                            [ngClass]="{
                              'text-success': cliente.estatus=='Activo', 
                              'text-muted':cliente.estatus=='Inactivo'
                            }">
                              {{ cliente.estatus }}
                          </small>
                        </span>
                      </a>
                    </li>
                 
                    <li class="p-20"></li>
                  </ul>
                </div>

                <div class="container">
                  <button *ngIf="!chatProyectos" 
                          class="btn btn-success btn-block waves-effect waves-light m-t-20"
                          data-toggle="modal" 
                          data-target="#nuevoCliente">Agregar Cliente</button>
                </div>

                <!-- Cliente Actual y proyectos -->
                <div class="chat-clients" *ngIf="chatProyectos">

                  <ul class="chatonline style-non cliente-actual m-0">
                    <li 
                      data-toggle="modal" 
                      data-target="#infoCliente">
                      <a href="javascript:void(0)" class="list-cliente">
                        <img [src]="clienteActual.imagen" 
                             *ngIf="clienteActual.imagen" 
                             class="img-circle">

                        <div class="iniciales-cliente align-content-center"
                             [ngStyle]="{ 'background-color': clienteActual.backgroundColor }"
                             *ngIf="!clienteActual.imagen">
                          {{ clienteActual.nombre | iniciales }}
                        </div>

                        <span>
                          {{ clienteActual.nombre }}
                          <small 
                            [ngClass]="{
                              'text-success': clienteActual.estatus=='Activo', 
                              'text-muted':clienteActual.estatus=='Inactivo'
                            }">
                              {{ clienteActual.estatus }}
                          </small>
                        </span>
                        <!-- <i class="fa fa-info-circle info-icon"></i> -->
                      </a>
                    </li>
                  </ul>

                  <hr class="m-t-0">
                  
                  <ul class="chatonline style-none">
                    <li *ngFor="let proyecto of proyectos; let i=index;"
                        (click)="mostrarChatProyecto(i); indexProyectoActual=i;">
                      <a href="javascript:void(0)" class="list-cliente">
                        <img [src]="proyecto.imagen" alt="user-img" class="img-circle">
                        <span>
                          {{ proyecto.nombre }}
                          <small [ngClass]="{
                              'text-success': proyecto.estatus=='Activo', 
                              'text-muted':proyecto.estatus=='Terminado'
                            }">
                            {{ proyecto.estatus }}
                          </small>
                        </span>
                      </a>
                    </li>
                  
                    <li class="p-20"></li>
                  </ul>

                  <button class="btn btn-success waves-effect waves-light btn-block"
                           type="button"
                           data-toggle="modal" 
                           data-target="#nuevoProyecto">Agregar Proyecto</button>

                  <button class="btn btn-danger waves-effect waves-light btn-block"
                           (click)="chatProyectos=false; this.indexProyectoActual=null; chats=[]">Regresar</button>
                </div>

            </div>
            <!-- End Clientes .chat-left-panel -->
            <!-- .chat-right-panel -->
            
            <div class="chat-right-aside chat-historial col col-lg-9 col-md-9 col-sm-12 col-12">
              
              <div *ngIf="indexProyectoActual!=null" class="row">
                <div class="col col-12 col-sm-9 col-md-9">
                  <h3>Historial del proyecto: {{ proyectos[indexProyectoActual].nombre }}</h3>
                </div>

                <div class="col col-12 col-sm-3 col-md-3">
                  <button class="btn btn-info waves-effect waves-light"
                          type="button"
                          data-toggle="modal" 
                          data-target="#cotizacion">Cotización <i class="fa fa-file-text-o"></i></button>
                </div>
              </div>

              <h3 *ngIf="indexProyectoActual==null">Historial del proyecto</h3>

                <hr>

              <!-- Chat Body -->
              <div id="chatBody" class="chat-rbox">
                <ul class="chat-list p-20">
                  <!--chat Row -->

                  <!-- Placeholder cuando no hay mensajes -->
                  <div class="chat-placeholder"
                       *ngIf="chats.length==0">
                    <i class="fa fa-comments"></i>
                    <p>Sin Mensajes</p>
                  </div>
                  <!-- Fin de placeholder  -->
                  <li *ngFor="let chat of chats" [ngClass]="{'reverse': chat.usuario.nombre!='Michelle Felix'}">
                    <div *ngIf="chat.usuario.nombre=='Michelle Felix'" class="chat-img">
                      <img [src]="chat.usuario.imagen" alt="user" />
                    </div>
                    <div class="chat-content">
                      <h5>{{ chat.usuario.nombre }}</h5>
                      <div *ngIf="!chat.audio" class="box bg-mensaje">{{ chat.mensaje }}</div>
                      <audio controls [src]="chat.audio" *ngIf="chat.audio">Audio</audio>
                    </div>
                    <div *ngIf="chat.usuario.nombre!='Michelle Felix'" class="chat-img">
                      <img [src]="chat.usuario.imagen" alt="user" />
                    </div>
                    <div class="chat-time">{{ chat.hora }}</div>
                  </li>
                </ul>
              </div>

              <hr>

              <div class="card-body b-t"
                   *ngIf="indexProyectoActual!=null">
                <div class="row">
                  <div class="col-12">
                    <textarea placeholder="Type your message here" class="form-control"
                              [(ngModel)]="mensaje"
                              (keydown.enter)="agregarChat($event,false);"></textarea>
                  </div>

                  <div class="col-12 text-left botonera">

                    <button type="button" class="btn btn-info waves-effect waves-light"
                            (click)="agregarChat($event,false)"><i class="fa fa-paper-plane-o"></i> Send</button>
                    <button type="button" class="btn btn-success waves-effect waves-light"><i class="fa fa-upload"></i> File</button>
                    <!-- Botonera de grabacion de audio -->
                    <div class="btn-group">
                      <button type="button" 
                              (click)="recordAudio()" 
                              class="btn btn-warning waves-effect waves-light btn-audio">
                              <i class="fa fa-microphone color-animation"
                                 [ngClass]="{'color-animation': grabandoAudio}"></i></button>
                      <button id="stopButton" 
                              (click)="stopRecording()"
                              class="btn btn-warning waves-effect waves-light btn-audio">
                              <i class="fa fa-stop"></i></button>
                      <button class="btn btn-warning btn-audio waves-effect waves-light"
                              (click)="playAudio()"><i class="fa fa-play"></i></button>
                      <button class="btn btn-warning btn-audio waves-effect waves-light"
                              (click)="agregarChat($event,true)">Enviar</button>
                    </div>
                    <!-- Termina botonera de grabación de audio -->

                    <button class="btn btn-danger waves-effect waves-light"
                            [routerLink]="['/calendario']"><i class="fa fa-calendar"></i> Agenda</button>
                    
                  </div>
                </div>
              </div>
              
            </div>
            <!-- .chat-right-panel -->
          </div>
        </div>
        <!-- /.chat-row -->
      </div>
    </div>
    
    </div>
  <!-- ============================================================== -->
  <!-- End Chat Component -->
  <!-- ============================================================== -->

  <!-- Componente Modal -->
  <app-modal
     tituloModal="Nuevo Proyecto"
     (nuevoProyecto)="agregarProyecto($event)"></app-modal>

   <app-info-client
    [cliente]="clienteActual"
    (cambiosCliente)="guardarCambiosCliente($event)"></app-info-client>

  <app-nuevo-cliente
    (clienteNuevo)="registrarClienteNuevo($event)"></app-nuevo-cliente>

  <app-cotizacion *ngIf="indexProyectoActual!=null"
    [proyecto]="proyectos[indexProyectoActual]"
    [cliente]="clienteActual"></app-cotizacion>